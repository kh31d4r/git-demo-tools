#!/bin/bash

if [ -z $EXAMPLEREPOS ]; then
    echo '$EXAMPLEREPOS not set!';
    exit 1;
fi

if [ -z $1 ]; then
    echo 'No example repo name given';
    exit 1;
fi

init()
{
    mkdir .git;
    mkdir .git/refs;
    mkdir .git/objects;
    echo 'ref: refs/heads/master' > .git/HEAD;
}

find_repo_root()
{
    start_dir=$PWD;

    if [ -d .git ]; then
        return;
    fi
    if [ $PWD = "/" ]; then
        echo "Not in a git repository";
        exit 1;
    fi

    cd ..;
    find_repo_root;
}

replace_current_repo()
{
    rm -rf .git *;
    init;
    git remote add origin $EXAMPLEREPOS/$1;
    git pull -q origin master;
    git remote rm origin;
}


find_repo_root;
replace_current_repo $1;
